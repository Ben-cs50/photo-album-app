{% extends "base.html" %}

{% block content %}
<div class="column is-10 is-offset-1" style="text-align:left">
  {% if album %}
  <div class="box" style="padding:24px">
    <h1 class="title">Album #{{ album.id }} â€” {{ album.title }}</h1>
  </div>
  <div class="columns is-multiline" style="margin-top:10px">
    {% for p in photos %}
    <div class="column is-one-quarter">
      <a href="{{ url_for('photo_page', photo_id=p.id) }}" data-photo-id="{{ p.id }}" data-photo-url="{{ p.url }}" data-photo-title="{{ p.title }}" style="display:block; text-decoration:none; color:inherit; cursor:pointer" class="album-tile">
        <figure class="image is-4by3" style="border-radius:12px; overflow:hidden; box-shadow:0 6px 18px rgba(2,6,23,0.45); transition: transform .28s ease, box-shadow .28s ease; background:#0b1220">
          <img src="{{ p.url }}" alt="{{ p.title }}" style="width:100%; height:100%; object-fit:cover; display:block" onerror="this.onerror=null; this.src='{{ p.thumbnailUrl }}'">
        </figure>
        <p style="margin-top:8px">{{ p.title }}</p>
      </a>
    </div>
    {% endfor %}
  </div>
  <!-- Lightbox for album (prev/next like Home) -->
  <div class="lightbox" id="albumLightbox" role="dialog" aria-modal="true" aria-hidden="true" style="position:fixed;top:0;left:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(1,6,16,0.85), rgba(1,6,16,1));z-index:80;padding:32px">
    <div class="frame" role="document" style="max-width:1100px;width:100%;max-height:90vh;background:rgba(10,14,20,0.6);border-radius:12px;overflow:hidden;display:grid;grid-template-columns:1fr 360px">
      <div class="bigimg" id="albBig" style="background-size:contain;background-repeat:no-repeat;background-position:center;height:100%;background-color:#071223"></div>
      <div class="info" style="padding:20px;display:flex;flex-direction:column;gap:12px">
        <h2 id="albTitle" style="margin:0;font-family:'Playfair Display'">Title</h2>
        <div class="actions" style="margin-top:auto;display:flex;gap:10px;align-items:center">
          <button class="button is-light" id="albPrev">Prev</button>
          <button class="button is-light" id="albNext">Next</button>
          <button class="button is-info" id="albDownload">Download</button>
          <button class="button" id="albClose">Close</button>
        </div>
      </div>
    </div>
  </div>
  {% else %}
  <p>Album not found.</p>
  {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    const links = Array.from(document.querySelectorAll('.album-tile'));
    if(!links.length) return;
    const lightbox = document.getElementById('albumLightbox');
    const big = document.getElementById('albBig');
    const title = document.getElementById('albTitle');
    const prev = document.getElementById('albPrev');
    const next = document.getElementById('albNext');
    const close = document.getElementById('albClose');
    const download = document.getElementById('albDownload');
    let current = 0;
    const data = links.map(a=>({ id: Number(a.dataset.photoId), url: a.dataset.photoUrl, title: a.dataset.photoTitle }));
    function show(){
      const item = data[current];
      big.style.backgroundImage = `url('${item.url}')`;
      title.textContent = item.title || `Photo #${item.id}`;
    }
    function open(i){ current = i; show(); lightbox.style.display='flex'; lightbox.setAttribute('aria-hidden','false'); }
    function closeLb(){ lightbox.style.display='none'; lightbox.setAttribute('aria-hidden','true'); }
    links.forEach((a, i)=>{
      a.addEventListener('click', (e)=>{ e.preventDefault(); open(i); });
    });
    prev.addEventListener('click', ()=>{ if(current>0){ current--; show(); } });
    next.addEventListener('click', ()=>{ if(current<data.length-1){ current++; show(); } });
    close.addEventListener('click', closeLb);
    lightbox.addEventListener('click', (e)=>{ if(e.target===lightbox) closeLb(); });
    download.addEventListener('click', ()=>{ const url = data[current].url; const a = document.createElement('a'); a.href = url; a.download = (data[current].title || 'photo') + '.jpg'; document.body.appendChild(a); a.click(); a.remove(); });
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeLb(); if(e.key==='ArrowLeft') prev.click(); if(e.key==='ArrowRight') next.click(); });
  })();
</script>
{% endblock %}


