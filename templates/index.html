<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Albums & Photos</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --bg: #0f1724;
      --card: #0b1220;
      --accent: #ffd166;
      --muted: #94a3b8;
      --glass: rgba(255, 255, 255, 0.04);
      --radius: 14px;
      --gap: 20px;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: radial-gradient(1200px 600px at 10% 10%, rgba(255, 209, 102, 0.04), transparent), linear-gradient(180deg, #071029 0%, #081328 60%);
      color: #e6eef8;
      padding: 32px
    }

    .container {
      max-width: 1200px;
      margin: 0 auto
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 20px
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px
    }

    .logo {
      width: 62px;
      height: 62px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--accent), #ffb4a2);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Playfair Display';
      font-weight: 700;
      color: #061423;
      font-size: 18px
    }

    .navbar {
      background: transparent
    }

    .navbar-item {
      color: #e6eef8
    }

    .navbar-item:hover {
      background: rgba(255, 255, 255, 0.06)
    }

    .hero.is-primary {
      background: transparent
    }

    .box {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: var(--radius);
      color: #e6eef8
    }

    .title,
    .subtitle {
      color: #e6eef8;
      font-family: 'Playfair Display'
    }

    .button.is-info {
      background: var(--accent);
      color: #061423;
      border: 0
    }

    .button.is-light {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e6eef8
    }

    input.input,
    .select select,
    textarea.textarea {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: #e6eef8
    }

    .footer-hint {
      color: var(--muted);
      text-align: center;
      margin-top: 10px
    }

    h1 {
      font-family: 'Playfair Display';
      font-size: 20px;
      margin: 0
    }

    p.lead {
      margin: 0;
      color: var(--muted);
      font-size: 14px
    }

    .controls {
      display: flex;
      gap: 12px;
      align-items: center
    }

    .search {
      background: var(--glass);
      border: 1px solid rgba(255, 255, 255, 0.04);
      padding: 10px 12px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      gap: 8px;
      backdrop-filter: blur(6px)
    }

    .search input {
      background: transparent;
      border: 0;
      outline: none;
      color: inherit;
      font-size: 14px;
      width: 160px
    }

    .filters {
      display: flex;
      gap: 8px;
      align-items: center
    }

    .chip {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 13px;
      cursor: pointer
    }

    .chip.active {
      background: linear-gradient(90deg, rgba(255, 209, 102, 0.12), rgba(255, 180, 162, 0.06));
      border-color: rgba(255, 209, 102, 0.18)
    }

    main {
      margin-top: 18px
    }

    .section-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px
    }

    .section-title h2 {
      margin: 0;
      font-family: 'Playfair Display'
    }

    /* Albums grid */
    .albums {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--gap)
    }

    @media (max-width:980px) {
      .albums {
        grid-template-columns: repeat(2, 1fr)
      }
    }

    @media (max-width:640px) {
      .albums {
        grid-template-columns: 1fr
      }
    }

    .album-card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.03);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      min-height: 160px
    }

    .album-thumb {
      height: 120px;
      background-size: cover;
      background-position: center
    }

    .album-meta {
      padding: 12px 14px;
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .album-meta .info {
      display: flex;
      flex-direction: column
    }

    .album-meta .title {
      font-weight: 600
    }

    .album-meta .count {
      font-size: 13px;
      color: var(--muted)
    }

    /* Photo grid (used for album view & gallery) */
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--gap);
      margin-top: 8px
    }

    @media (max-width:980px) {
      .grid {
        grid-template-columns: repeat(2, 1fr)
      }
    }

    @media (max-width:640px) {
      .grid {
        grid-template-columns: 1fr
      }
    }

    .card {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
      border-radius: 12px;
      overflow: hidden;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.03);
      transition: transform .36s cubic-bezier(.2, .9, .2, 1), box-shadow .36s;
      box-shadow: 0 6px 20px rgba(2, 6, 23, 0.5);
      cursor: zoom-in;
      min-height: 220px;
      display: flex;
      flex-direction: column
    }

    .card:hover {
      transform: translateY(-8px);
      box-shadow: 0 18px 50px rgba(2, 6, 23, 0.7)
    }

    .thumb {
      flex: 1 1 auto;
      background-size: cover;
      background-position: center;
      height: 220px
    }

    .meta {
      padding: 14px 16px;
      border-top: 1px solid rgba(255, 255, 255, 0.02);
      display: flex;
      justify-content: space-between;
      align-items: center
    }

    .meta .title {
      font-weight: 600;
      font-size: 15px
    }

    .meta .tag {
      font-size: 13px;
      color: var(--muted)
    }

    .overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, transparent 40%, rgba(2, 6, 23, 0.45) 100%);
      pointer-events: none
    }

    /* Album modal */
    .album-modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, rgba(1, 6, 16, 0.7), rgba(1, 6, 16, 0.95));
      z-index: 60;
      padding: 30px
    }

    .album-modal.open {
      display: flex
    }

    .album-content {
      max-width: 1100px;
      width: 100%;
      max-height: 90vh;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), transparent);
      border-radius: 12px;
      overflow: auto;
      padding: 18px
    }

    .album-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px
    }

    .album-title {
      font-family: 'Playfair Display';
      font-size: 20px
    }

    /* Lightbox */
    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: linear-gradient(180deg, rgba(1, 6, 16, 0.85), rgba(1, 6, 16, 1));
      z-index: 80;
      padding: 32px
    }

    .lightbox.open {
      display: flex
    }

    .lightbox .frame {
      max-width: 1100px;
      width: 100%;
      max-height: 90vh;
      background: rgba(10, 14, 20, 0.6);
      border-radius: 12px;
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr 360px
    }

    @media(max-width:980px) {
      .lightbox .frame {
        grid-template-columns: 1fr
      }
    }

    .bigimg {
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      height: 100%;
      background-color: #071223
    }

    .info {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px
    }

    .info h2 {
      margin: 0;
      font-family: 'Playfair Display'
    }

    .info p {
      margin: 0;
      color: var(--muted);
      font-size: 14px
    }

    .actions {
      margin-top: auto;
      display: flex;
      gap: 10px;
      align-items: center
    }

    .btn {
      padding: 10px 14px;
      border-radius: 10px;
      border: 0;
      cursor: pointer;
      font-weight: 600
    }

    .btn.ghost {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.06)
    }

    .btn.primary {
      background: var(--accent);
      color: #061423
    }

    footer {
      margin-top: 28px;
      color: var(--muted);
      font-size: 13px;
      text-align: center
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="hero is-primary is-fullheight">
      <div class="brand">
        <div class="logo">G</div>
        <div>
          <h1>Gallery</h1>
          <p class="lead">Albums & photos — browse collections or dive into individual works.</p>
        </div>
      </div>
      <div class="controls">
        <label class="search" aria-hidden>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden focusable="false">
            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.25" stroke-linecap="round"
              stroke-linejoin="round" opacity="0.7" />
            <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.25" opacity="0.7" />
          </svg>
          <input id="search" placeholder="Search artists or albums..." aria-label="Search artworks">
        </label>
      </div>

      <div class="hero-head">
        <nav class="navbar">
          <div class="container">
            <div id="navbarMenuHeroA" class="navbar-menu">
              <div class="navbar-end">

                {% if session.get('user') %}
                <span class="navbar-item" style="opacity:.9">
                  <span
                    style="display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.08);padding:8px 12px;border-radius:999px">
                    <span
                      style="width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,var(--accent),#ffb4a2);display:inline-flex;align-items:center;justify-content:center;color:#061423;font-weight:700">
                      {{ session['user']['name'][:1] if session['user']['name'] else 'U' }}
                    </span>
                    <span style="font-weight:600">{{ session['user']['name'] }}</span>
                    <span style="color:var(--muted);font-size:12px">{{ session['user']['email'] }}</span>
                  </span>
                </span>
                <a href="{{ url_for('albums_page') }}" class="navbar-item">
                  Album
                </a>

                <a href="{{ url_for('photos_page') }}" class="navbar-item">
                  Photo
                </a>

                <a href="{{ url_for('profile') }}" class="navbar-item">
                  Profile
                </a>
                <a href="{{ url_for('logout') }}" class="navbar-item">
                  Logout
                </a>
                {% else %}
                <a href="{{ url_for('albums_page') }}" class="navbar-item">
                  Album
                </a>

                <a href="{{ url_for('photos_page') }}" class="navbar-item">
                  Photo
                </a>

                <a href="{{ url_for('profile') }}" class="navbar-item">
                  Profile
                </a>
                <a href="{{ url_for('login') }}" class="navbar-item">
                  Login
                </a>
                <a href="{{ url_for('signup') }}" class="navbar-item">
                  Sign Up
                </a>

                {% endif %}



              </div>
            </div>
          </div>
        </nav>
      </div>
    </header>

    <main>
      <!-- Albums Section -->
      <section>
        <div class="section-title">
          <h2>Albums</h2>
          <div class="chip">+ New Album</div>
        </div>

        <div class="albums" id="albums">
          <!-- Album cards injected by JS -->
        </div>
      </section>

      <!-- Gallery (All photos) -->
      <section style="margin-top:28px">
        <div class="section-title">
          <h2>All Photos</h2>
          <div class="chip" id="toggleAlbums">Show Albums</div>
        </div>
        <section class="grid" id="gallery">
          <!-- Photo cards injected by JS -->
        </section>
      </section>

    </main>

    <footer>
      Tip: Click an album to open it. Click any photo to view details in a lightbox.
    </footer>
  </div>

  <!-- Album modal (shows photos inside an album) -->
  <div class="album-modal" id="albumModal" aria-hidden="true">
    <div class="album-content" role="dialog" aria-modal="true">
      <div class="album-header">
        <div class="album-title" id="albumModalTitle">Album</div>
        <div style="margin-left:auto;color:var(--muted)" id="albumCount">0 photos</div>
        <button class="btn ghost" id="closeAlbum">Close</button>
      </div>
      <div class="grid" id="albumPhotos"></div>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="frame" role="document">
      <div class="bigimg" id="lightboxImage" aria-hidden></div>
      <div class="info">
        <h2 id="lightboxTitle">Title</h2>
        <p id="lightboxArtist">Artist — medium, year</p>
        <p id="lightboxDesc" style="color:var(--muted);font-size:14px">A short description of the work goes here.</p>
        <div class="actions">
          <button class="btn ghost" id="prev">Prev</button>
          <button class="btn ghost" id="next">Next</button>
          <button class="btn primary" id="download">Download</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://jsonplaceholder.typicode.com';
    let albumsData = [];
    let allPhotos = [];

    const albumsEl = document.getElementById('albums');
    const galleryEl = document.getElementById('gallery');

    function renderAlbums() {
      albumsEl.innerHTML = '';
      albumsData.forEach(album => {
        const div = document.createElement('div');
        div.className = 'album-card';
        div.innerHTML = `
          <div class="album-thumb" style="background-image:url('${album.cover}')"></div>
          <div class="album-meta">
            <div class="info"><div class="title">${album.title}</div><div class="count">${album.photoCount || ''}</div></div>
            <div class="chip">Open</div>
          </div>
        `;
        div.addEventListener('click', () => { window.location.href = '/album/' + album.id; });
        albumsEl.appendChild(div);
      });
    }

    function renderGallery(photos) {
      galleryEl.innerHTML = '';
      photos.forEach(photo => {
        const art = document.createElement('article');
        art.className = 'card fadeIn';
        art.innerHTML = `
          <div class="thumb" style="background-image:url('${photo.thumbnailUrl}')"></div>
          <div class="overlay"></div>
          <div class="meta">
            <div>
              <div class="title">${photo.title}</div>
              <div class="tag">Album #${photo.albumId}</div>
            </div>
            <div class="tag">ID: ${photo.id}</div>
          </div>
        `;
        art.addEventListener('click', () => { window.location.href = '/photo/' + photo.id; });
        galleryEl.appendChild(art);
      });
    }

    // Album modal controls
    const albumModal = document.getElementById('albumModal');
    const albumModalTitle = document.getElementById('albumModalTitle');
    const albumCount = document.getElementById('albumCount');
    const albumPhotos = document.getElementById('albumPhotos');
    const closeAlbum = document.getElementById('closeAlbum');

    function closeAlbumModal() { albumModal.classList.remove('open'); albumModal.setAttribute('aria-hidden', 'true'); }
    closeAlbum.addEventListener('click', closeAlbumModal);
    albumModal.addEventListener('click', (e) => { if (e.target === albumModal) closeAlbumModal(); });

    // Lightbox controls
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightboxImage');
    const lightboxTitle = document.getElementById('lightboxTitle');
    const lightboxArtist = document.getElementById('lightboxArtist');
    const lightboxDesc = document.getElementById('lightboxDesc');
    const prevBtn = document.getElementById('prev');
    const nextBtn = document.getElementById('next');
    const downloadBtn = document.getElementById('download');

    let currentSet = [];
    let currentIndex = 0;

    function openLightbox(set, id) {
      currentSet = set;
      currentIndex = set.findIndex(p => p.id === id);
      if (currentIndex < 0) currentIndex = 0;
      showCurrent();
      lightbox.classList.add('open');
      lightbox.setAttribute('aria-hidden', 'false');
    }

    function showCurrent() {
      const item = currentSet[currentIndex];
      lightboxImage.style.backgroundImage = `url('${item.url}')`;
      lightboxTitle.textContent = item.title;
      lightboxArtist.textContent = `Album #${item.albumId}`;
      lightboxDesc.textContent = '';
    }

    function closeLightbox() { lightbox.classList.remove('open'); lightbox.setAttribute('aria-hidden', 'true'); }

    prevBtn.addEventListener('click', () => { if (currentIndex > 0) { currentIndex--; showCurrent(); } });
    nextBtn.addEventListener('click', () => { if (currentIndex < currentSet.length - 1) { currentIndex++; showCurrent(); } });
    downloadBtn.addEventListener('click', () => { const url = currentSet[currentIndex].url; const a = document.createElement('a'); a.href = url; a.download = (currentSet[currentIndex].title || 'photo') + '.jpg'; document.body.appendChild(a); a.click(); a.remove(); });

    lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });

    // Search
    const searchInput = document.getElementById('search');
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      if (!q) return renderGallery(allPhotos);
      const filtered = allPhotos.filter(p => (p.title + String(p.albumId)).toLowerCase().includes(q));
      renderGallery(filtered);
    });

    async function loadData() {
      try {
        const [albumsResp, photosResp] = await Promise.all([
          fetch(`${API_BASE}/albums`),
          fetch(`${API_BASE}/photos`)
        ]);
        const albums = await albumsResp.json();
        const photos = await photosResp.json();
        // Map first photo per album to use as cover and count photos per album
        const firstPhotoByAlbum = {};
        const counts = {};
        for (const p of photos) {
          if (firstPhotoByAlbum[p.albumId] === undefined) { firstPhotoByAlbum[p.albumId] = p; }
          counts[p.albumId] = (counts[p.albumId] || 0) + 1;
        }
        albumsData = albums.slice(0, 9).map(a => ({ ...a, cover: (firstPhotoByAlbum[a.id] && firstPhotoByAlbum[a.id].thumbnailUrl) || '', photoCount: counts[a.id] || 0 }));
        // Use a subset for gallery for performance but still from the API
        allPhotos = photos.slice(0, 60);
        renderAlbums();
        renderGallery(allPhotos);
      } catch (e) {
        console.error(e);
      }
    }

    loadData();

    // expose toggle
    document.getElementById('toggleAlbums').addEventListener('click', () => { const sc = document.querySelector('section'); sc.scrollIntoView({ behavior: 'smooth' }); });

    // Accessibility: close with Escape
    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { closeLightbox(); closeAlbumModal(); }
    });
  </script>
</body>

</html>